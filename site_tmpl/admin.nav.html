{% load lineage %} {% load permissionif %} {% load cache %}
<nav class="navbar navbar-expand-md navbar-inverse sticky-md-top bg-dark rounded-0 mb-4 py-0" role="navigation">
    <div class="fs-6 container-fluid justify-content-start">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-target="#db-navbar-collapse-1" aria-controls="db-navbar-collapse-1">
            <span class="navbar-toggler-icon"></span>
            <span class="visually-hidden">Toggle navigation</span>
        </button>

        <a class="navbar-brand" href="{% url "home" %}">LNLDB</a>

        <div id="db-navbar-collapse-1" class="collapse navbar-collapse container-fluid d-flex justify-content-between align-items-center">
            <ul class="navbar-nav align-items-center">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" href="#">Events <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="{% url "my:events" %}">My Events</a></li>
                        <li><a class="dropdown-item" href="{{ request.scheme }}://{{ request.get_host }}/workorder">Event Wizard</a></li>

                        {% permission request.user has 'events.add_raw_event' %}
                        <li><a class="dropdown-item" href="{% url "events:new" %}">Add Event</a></li>
                        {% endpermission %} {% permission request.user has 'events.view_event' %}
                        <li><hr class="dropdown-divider"></li>
                        {% endpermission %} {% permission request.user has 'events.approve_event' %}
                        <li><a class="dropdown-item" href="{% url "events:incoming" %}">Incoming Events</a></li>
                        {% endpermission %} {% permission request.user has 'events.can_chief_event' %}
                        <li><a class="dropdown-item" href="{% url "events:findchief" %}">Needs a Chief</a></li>
                        {% endpermission %} {% permission request.user has 'events.view_event' %}
                        <li><a class="dropdown-item" href="{% url "events:upcoming" %}">Upcoming Events</a></li>
                        <li><a class="dropdown-item" ref="{% url "events:open" %}">Open Events</a></li>
                        <li><a class="dropdown-item" href="{% url "events:closed" %}">Closed Events</a></li>
                        <li><a class="dropdown-item" href="{% url "events:all" %}">All Events</a></li>
                        {% endpermission %} {% permission request.user has 'events.view_event_billing' %}
                        <li><hr class="dropdown-divider"></li>
                        <li class="dropdown-header">Event Payments</li>

                        <li><a class="dropdown-item" href="{% url "events:unreviewed" %}">Events Pending Review</a></li>
                        <li><a class="dropdown-item" href="{% url "events:unbilled" %}">Events to be Billed</a></li>
                        <li><a class="dropdown-item" href="{% url "events:unbilled-semester" %}">Events to be Billed in Bulk</a></li>
                        <li><a class="dropdown-item" href="{% url "events:unpaid" %}">Events Billed, Pending Payment</a></li>
                        <li><a class="dropdown-item" href="{% url "events:awaitingworkday" %}">Events Awaiting Workday Entry</a></li>
                        <li><a class="dropdown-item" href="{% url "events:unpaid-workday" %}">Events Entered Into Workday</a></li>
                        <li><a class="dropdown-item" href="{% url "events:paid" %}">Events Paid</a></li>
                        <li><a class="dropdown-item" href="{% url "events:multibillings:list" %}">MultiBills</a></li>
                        {% endpermission %} {% permission request.user has 'events.edit_workshops' %}
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="{% url "events:workshops:list" %}">Workshops</a></li>
                        {% endpermission %}
                    </ul>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#">Clients <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="{% url "my:orgs" %}">My Organizations</a></li>
                        {% permission request.user has 'events.view_org' %}
                        <li><a class="dropdown-item" href="{% url "orgs:list" %}">View Organizations</a></li>
                        {% endpermission %} {% permission request.user has 'events.add_org' %}
                        <li><a class="dropdown-item" href="{% url "orgs:add" %}">Add Organization</a></li>
                        {% else %}
                        <li><a class="dropdown-item" href="{% url "my:org-request" %}">Request Organization</a></li>
                        {% endpermission %} {% permission request.user has 'events.view_posteventsurveyresults' %}
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="{% url 'survey-dashboard' %}">Survey Dashboard</a></li>
                        {% endpermission %}
                    </ul>
                </li>
                {% permission request.user has 'accounts.view_user' or request.user has 'accounts.view_member' %}
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#">Members <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="{% url "accounts:officers" %}">Officers</a></li>
                        <li><a class="dropdown-item" href="{% url "accounts:active" %}">Active</a></li>
                        <li><a class="dropdown-item" href="{% url "accounts:away" %}">Away</a></li>
                        <li><a class="dropdown-item" href="{% url "accounts:inactive" %}">Inactive</a></li>
                        <li><a class="dropdown-item" href="{% url "accounts:associate" %}">Associate</a></li>
                        <li><a class="dropdown-item" href="{% url "accounts:alumni" %}">Alumni</a></li>
                        <li><a class="dropdown-item" href="{% url "accounts:allmembers" %}">All Members</a></li>
                        {% permission request.user has 'accounts.view_user' %}
                        <li><a class="dropdown-item" href="{% url "accounts:limbo" %}">Unaffiliated Users</a></li>
                        {% endpermission %}
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="{% url "accounts:mdc" %}">MDC List</a></li>
                        {% permission request.user has 'emails.send' or request.user has 'events.edit_event_hours' %}
                        <li><a class="dropdown-item" href="{% url "emails:dispatch" %}">Send Message...</a></li>
                        {% permission request.user has 'slack.view_reportedmessage' %}
                        <li><a class="dropdown-item" href="{% url "slack:moderate" %}">Moderate Slack</a></li>
                        {% endpermission %}
                        <li><hr class="dropdown-divider"></li>
                        {% endpermission %} {% permission request.user has 'events.view_attendance_records' %}
                        <li><a class="dropdown-item" href="{% url "events:crew-logs" %}">Crew Logs</a></li>
                        {% endpermission %}
                        <li><a class="dropdown-item" href="{% url "members:training:list" %}">Training</a></li>
                        {% permission request.user has 'accounts.change_membership' %}
                        <li><a class="dropdown-item" href="{% url "accounts:secretary_dashboard" %}">Secretary</a></li>
                        {% endpermission %} {% permission request.user has 'accounts.add_user' %}
                        <li><a class="dropdown-item" href="{% url "accounts:add" %}">Add User</a></li>
                        {% endpermission %}
                    </ul>
                </li>
                {% endpermission %} {% permission request.user has 'meetings.list_mtgs' %}
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#">Meetings <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="{% url "meetings:list" %}">View Meetings</a></li>
                        {% permission request.user has 'meetings.create_mtg' %}
                        <li><a class="dropdown-item" href="{% url "meetings:new" %}">New Meeting</a></li>
                        {% endpermission %}
                    </ul>
                </li>
                {% endpermission %} {% permission request.user has 'inventory.view_equipment' %}
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#">Equipment <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" target="_blank" href="https://wpi0.sharepoint.com/:f:/r/sites/gr-lnl/Shared%20Documents/Technical%20Reference?csf=1&e=uEtBtt">User Guides &amp; Datasheets</a></li>
                        {% if request.user.is_superuser %}
                        <li><a class="dropdown-item" href="{% url 'mdm:list' %}">MDM Console</a></li>
                        {% endif %} {% permission request.user has 'devices.view_laptop' %}
                        <li><a class="dropdown-item" href="{% url 'laptops:list' %}">Laptops</a></li>
                        {% endpermission %}
                        <li><a class="dropdown-item" href="{% url 'inventory:snipe_checkout' %}">Inventory checkout</a></li>
                        <li><a class="dropdown-item" href="{% url 'inventory:snipe_checkin' %}">Inventory checkin</a></li>
                        {% permission request.user has 'inventory.view_access_logs' %}
                        <li><a class="dropdown-item" href="{% url 'inventory:view_logs' %}">Access Logs</a></li>
                        {% endpermission %}
                        <li><a class="dropdown-item" href="{% url 'inventory:snipe_password' %}">View inventory - Snipe</a></li>
                        <li><a class="dropdown-item" target="_blank" href="https://lnl-rt.wpi.edu/rt/">Repairs ticket system - RT <i class="glyphicon glyphicon-new-window"></i></a></li>
                    </ul>
                </li>
                {% endpermission %} {% permission request.user has 'projection.view_pits' or request.user has 'projection.add_bulk_events' %}
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#">Projection <b class="caret"></b></a>
                    <ul class="dropdown-menu me-auto">
                        {% permission request.user has 'projection.view_pits' %}
                        <li><a class="dropdown-item" href="{% url "projection:grid" %}">View Projectionists</a></li>
                        {% endpermission %} {% permission request.user has 'projection.view_pits' %}
                        <li><a class="dropdown-item" href="{% url "projection:pit-request" %}">Request Training</a></li>
                        {% endpermission %} {% permission request.user has 'projection.edit_pits' %}
                        <li><a class="dropdown-item" href="{% url "projection:pit-schedule" %}">Schedule PITs</a></li>
                        <li><a class="dropdown-item" href="{% url "projection:bulk-edit" %}">Bulk Update Projectionists</a></li>
                        {% endpermission %} {% permission request.user has 'projection.add_bulk_events' %}
                        <li><a class="dropdown-item" href="{% url "projection:add-movies" %}">Bulk Add Movies</a></li>
                        {% endpermission %}
                    </ul>
                </li>
                {% endpermission %} {% permission request.user has 'data.search' %}
                <li class="nav-item">
                    <form class="navbar-form navbar-left" action="{% url "events-search" %}" method="GET" role="search">
                        <div class="form-group">
                            <input type="text" class="lh-1 form-control" name="q" placeholder="Search Events" {% if q %} value="{{ q }}" {% endif %}>
                        </div>
                    </form>
                </li>
                {% endpermission %}
                <!-- paste menu bar text above here -->
            </ul>
            <div id="navbar-login" class="navbar-text d-flex justify-content-between align-content-center"> <div>
                {% if request.user.pk %} Logged in as <a href="{% url  "accounts:detail" request.user.pk %}" class="navbar-text navbar-link text-decoration-none">{{ request.user }}</a> &middot;
                <a class="navbar-link" href="{% url "accounts:logout" %}">Log Out</a> {% else %}
                <a class="navbar-link" href="{% url "accounts:login" %}">Log In</a> {% endif %}
            </div></div>
        </div>
        <!--/.nav-collapse -->
    </div>
    <!--     </div> -->
</nav>